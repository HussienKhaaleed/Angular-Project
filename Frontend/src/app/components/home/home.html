<!-- ---------------- Carousel Section ---------------- -->
<p-carousel
  [value]="products"
  [numVisible]="3"
  [numScroll]="1"
  [circular]="true"
  [autoplayInterval]="3000"
  [responsiveOptions]="responsiveOptions"
  styleClass="movie-carousel"
>
  <ng-template pTemplate="item" let-product>
    <div class="carousel-card" (click)="showDialogForProduct(product)">
      <div class="poster-container">
        <img [src]="product.image" [alt]="product.name" class="movie-poster" />
        <p-tag
          [value]="product.inventoryStatus"
          [severity]="getSeverity(product.inventoryStatus)"
          class="status-tag"
        ></p-tag>
      </div>

      <div class="movie-title">{{ product.name }}</div>

      <div class="movie-footer">
        <div class="price">${{ product.price }}</div>
        <div class="actions">
          <p-button
            icon="pi pi-heart"
            (click)="toggleFavoriteProduct(product); $event.stopPropagation()"
            [ngClass]="isFavoriteProduct(product.id) ? 'text-red-500' : 'text-gray-400'"
          ></p-button>

          <p-button icon="pi pi-shopping-cart" (click)="addToCartProduct(product)"></p-button>
        </div>
      </div>
    </div>
  </ng-template>
</p-carousel>

<!-- ---------------- Filter & Movie Grid ---------------- -->
<section>
  <div class="flex align-items-center justify-content-between mb-3">
    <h2 class="m-0">Filter by genre</h2>
    <div class="flex align-items-center gap-2">
      <p-multiSelect
        [options]="genres"
        optionLabel="name"
        optionValue="id"
        display="chip"
        placeholder="Select genres"
        [(ngModel)]="selectedGenres"
        (onChange)="onGenresChange()"
        class="min-w-20rem"
      ></p-multiSelect>
      <p-button
        label="Clear"
        icon="pi pi-times"
        severity="secondary"
        [outlined]="true"
        (onClick)="clearGenres()"
        [disabled]="!selectedGenres.length"
      ></p-button>
    </div>
  </div>

  <div *ngIf="loadingMovies" class="flex justify-content-center py-6">
    <p-progressSpinner strokeWidth="4"></p-progressSpinner>
  </div>

  <div class="movies-grid" *ngIf="!loadingMovies">
    <div class="movie-item" *ngFor="let m of movies">
      <p-card [header]="m.title" styleClass="clickable-card" (click)="showDialogForMovie(m)">
        <img [src]="m.posterUrl" [alt]="m.title" class="movie-poster" loading="lazy" />

        <p class="movie-description">
          {{ m.overview || 'No overview available.' }}
        </p>
        <div class="price">${{ m.price | number:'1.2-2' }}</div>

        <div class="flex justify-content-between mt-3 align-items-center">
          <div class="flex gap-3">
            <p-button
              icon="pi pi-heart"
              (click)="toggleFavoriteMovie(m)"
              [ngClass]="isFavoriteMovie(m.id) ? 'text-red-500' : 'text-gray-400'"
            >
            </p-button>

            <p-button icon="pi pi-shopping-cart" (click)="addToCartMovie(m)"> </p-button>
          </div>
        </div>
      </p-card>
    </div>
  </div>
</section>

<!-- ---------------- Movie Detail Dialog ---------------- -->
<p-dialog
  [header]="getMovieTitle()"
  [(visible)]="visible"
  [modal]="true"
  [style]="{ width: '50rem' }"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  [maximizable]="true"
>
  <div class="movie-detail-dialog">
    <div class="movie-detail-top flex gap-4">
      <img [src]="getMovieImage()" [alt]="getMovieTitle()" class="dialog-movie-image" />
      <div class="flex-1">
        <h3>Description</h3>
        <p>{{ getMovieOverview() }}</p>
      </div>
    </div>

    <div class="movie-reviews mt-4">
      <h3>Reviews</h3>

      <div *ngIf="getMovieReviews().length === 0" class="no-reviews">
        No reviews yet. Be the first to add one!
      </div>

      <div *ngFor="let review of getMovieReviews()" class="review-item mb-3">
        <div class="flex align-items-center justify-content-between mb-2">
          <p-rating [ngModel]="review.rating" [readonly]="true"></p-rating>
          <span class="review-date">{{ review.date }}</span>
        </div>
        <p class="review-text">{{ review.text }}</p>
      </div>
    </div>

    <div class="add-review mt-4">
      <h3>Add Your Review</h3>
      <div class="flex align-items-center mb-2">
        <label class="mr-2">Your Rating:</label>
        <p-rating [(ngModel)]="userRating"></p-rating>
      </div>
      <textarea
        pInputTextarea
        [(ngModel)]="newReview"
        placeholder="Write your review here..."
        [rows]="3"
        class="w-full mb-3"
      ></textarea>
      <p-button label="Submit Review" icon="pi pi-check" (click)="addReview()"></p-button>
    </div>
  </div>
</p-dialog>
